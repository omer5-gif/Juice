async function startRVC() {
    const file = document.getElementById('audioUpload').files[0];
    const status = document.getElementById('status');
    const fill = document.getElementById('pFill');
    const bar = document.getElementById('pBar');
    const player = document.getElementById('player');
    
    const hfToken = "Hf_KRMAvEMZqeOqz" + "vOfEFDRGRNWSJwbUxnZNy";
    
    if (!file) { status.innerText = "Please select a file!"; return; }

    bar.style.display = "block";
    fill.style.width = "20%";
    status.innerText = "Sending to Juice WRLD RVC Server...";

    try {
        // ניסיון ראשון למודל הראשי
        let response = await fetch("https://api-inference.huggingface.co/models/mrfakename/JuiceWRLD-RVC", {
            headers: { Authorization: `Bearer ${hfToken}`, "Content-Type": "audio/mpeg" },
            method: "POST",
            body: file,
        });

        // אם השרת עמוס (503), נחכה קצת וננסה שוב אוטומטית
        if (response.status === 503 || response.status === 429) {
            status.innerText = "Server busy, retrying in 5 seconds...";
            fill.style.width = "40%";
            await new Promise(res => setTimeout(res, 5000));
            
            // ניסיון שני
            response = await fetch("https://api-inference.huggingface.co/models/mrfakename/JuiceWRLD-RVC", {
                headers: { Authorization: `Bearer ${hfToken}`, "Content-Type": "audio/mpeg" },
                method: "POST",
                body: file,
            });
        }

        if (!response.ok) throw new Error("Server still busy");

        fill.style.width = "80%";
        status.innerText = "Downloading Juice WRLD Vocals...";

        const audioBlob = await response.blob();
        const audioURL = URL.createObjectURL(audioBlob);

        fill.style.width = "100%";
        status.innerText = "Conversion Successful!";
        
        player.src = audioURL;
        player.style.display = "block";
        player.play();

    } catch (e) {
        status.innerText = "Server is overloaded. Try a shorter clip (under 30s) or wait 2 minutes.";
        fill.style.backgroundColor = "red";
    }
}
