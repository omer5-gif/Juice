<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juice AI Studio - Kitsune Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; background: #010105; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
        .ui-container { position: relative; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; padding: 20px; pointer-events: none; }
        .studio-card { 
            background: rgba(10, 10, 20, 0.7); 
            backdrop-filter: blur(20px); 
            border-radius: 30px; 
            padding: 40px; 
            width: 90%; 
            max-width: 400px; 
            border: 1px solid rgba(138, 43, 226, 0.3); 
            text-align: center; 
            box-shadow: 0 0 50px rgba(138, 43, 226, 0.2);
            pointer-events: auto;
        }
        h1 { background: linear-gradient(45deg, #ff4d4d, #8a2be2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 32px; font-weight: 900; margin: 0; letter-spacing: 2px; }
        .sub-header { font-size: 12px; color: #8a2be2; letter-spacing: 4px; font-weight: bold; margin-bottom: 25px; text-transform: uppercase; }
        .btn-generate { 
            background: linear-gradient(45deg, #8a2be2, #ff4d4d); 
            color: white; border: none; padding: 18px; width: 100%; 
            border-radius: 12px; font-weight: bold; cursor: pointer; 
            font-size: 16px; transition: 0.3s; box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4);
        }
        .btn-generate:hover { transform: scale(1.02); box-shadow: 0 6px 20px rgba(255, 77, 77, 0.5); }
        #log-display { font-size: 13px; color: #bbb; margin-top: 20px; min-height: 40px; line-height: 1.5; }
        audio { width: 100%; margin-top: 20px; border-radius: 10px; filter: invert(1); opacity: 0.8; }
        input[type="file"] { margin: 20px 0; font-size: 12px; }
    </style>
</head>
<body>
    <div id="kitsune-bg" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:1;"></div>
    
    <div class="ui-container">
        <div class="studio-card">
            <h1>JUICE AI STUDIO</h1>
            <div class="sub-header">Legacy Visualizer</div>
            
            <input type="file" id="audioSource" accept="audio/*">
            <button class="btn-generate" onclick="handleProcess()">PLAY & VISUALIZE</button>
            
            <div id="log-display">העלה קובץ מהמחשב (או קאבר שהכנת ב-Jammable)</div>
            <audio id="player" controls></audio>
        </div>
    </div>

    <script>
        // --- Three.js Setup with Kitsune ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('kitsune-bg').appendChild(renderer.domElement);

        // יצירת צורה מורכבת יותר שמייצגת את הקיטסונה (Icosahedron)
        const geometry = new THREE.IcosahedronGeometry(2, 2);
        const material = new THREE.MeshPhongMaterial({ 
            color: 0x8a2be2, 
            wireframe: true,
            emissive: 0x4b0082,
            shininess: 100
        });
        const kitsune = new THREE.Mesh(geometry, material);
        scene.add(kitsune);

        const light = new THREE.PointLight(0xffffff, 1, 100);
        light.position.set(10, 10, 10);
        scene.add(light);
        camera.position.z = 5;

        // --- Audio Analysis Setup ---
        let audioCtx, analyser, dataArray, source;

        function initAudio(audioElement) {
            if (audioCtx) return; // מונע אתחול כפול
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioCtx.createAnalyser();
            source = audioCtx.createMediaElementSource(audioElement);
            source.connect(analyser);
            analyser.connect(audioCtx.destination);
            analyser.fftSize = 256;
            dataArray = new Uint8Array(analyser.frequencyBinCount);
        }

        function animate() {
            requestAnimationFrame(animate);
            
            kitsune.rotation.y += 0.005;
            kitsune.rotation.x += 0.002;

            if (analyser) {
                analyser.getByteFrequencyData(dataArray);
                // לוקחים את הממוצע של התדרים הנמוכים (הבאס)
                let lowerHalfArray = dataArray.slice(0, (dataArray.length/2) - 1);
                let sum = lowerHalfArray.reduce((a, b) => a + b, 0);
                let avg = sum / lowerHalfArray.length;
                
                // גורמים לקיטסונה לפעום לפי הבאס
                let scale = 1 + (avg / 150); 
                kitsune.scale.set(scale, scale, scale);
                kitsune.material.color.setHSL(0.7 + (avg/500), 0.8, 0.5); // שינוי צבע עדין
            }

            renderer.render(scene, camera);
        }
        animate();

        // --- Logic ---
        function handleProcess() {
            const file = document.getElementById('audioSource').files[0];
            const player = document.getElementById('player');
            const log = document.getElementById('log-display');

            if (!file) {
                log.innerText = "שכחת להעלות קובץ, אחי!";
                return;
            }

            log.innerText = "מעבד את הסאונד בסטודיו...";
            const url = URL.createObjectURL(file);
            player.src = url;
            
            initAudio(player);
            player.play();
            log.innerText = "מנגן עכשיו: Juice WRLD Style";
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
