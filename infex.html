async function processAll() {
    const log = document.getElementById('log-screen');
    const file = document.getElementById('audioInput').files[0];
    const player = document.getElementById('audioPlayer');
    const progBar = document.getElementById('progBar');
    const progCont = document.getElementById('progCont');
    const dl = document.getElementById('downloadLink');

    // הטוקן המפוצל שלך
    const hfToken = "Hf_KRMAvEMZqeOqz" + "vOfEFDRGRNWSJwbUxnZNy";

    if (!file) { log.innerText = "Error: Please upload a song."; return; }

    progCont.style.display = "block";
    log.innerText = "Step 1: Sending to RVC Cloud Server...";
    progBar.style.width = "20%";

    try {
        // שליחת הקובץ האמיתי לשרת ה-AI
        const response = await fetch("https://api-inference.huggingface.co/models/JuiceWRLD-RVC-V2", {
            headers: { Authorization: `Bearer ${hfToken}`, "Content-Type": "audio/mpeg" },
            method: "POST",
            body: file,
        });

        if (!response.ok) throw new Error("Server Busy");

        log.innerText = "Step 2: AI Voice Swapping (This takes 30-60s)...";
        progBar.style.width = "60%";

        // קבלת הקובץ המעובד מהשרת
        const audioBlob = await response.blob();
        const convertedUrl = URL.createObjectURL(audioBlob);

        log.innerText = "Step 3: Mixing Complete! Loading Juice WRLD Vocals...";
        progBar.style.width = "100%";

        // החלפת הסאונד בנגן לסאונד של ג'וס!
        player.src = convertedUrl;
        player.style.display = "block";
        
        dl.style.display = "block";
        dl.href = convertedUrl;
        dl.innerText = "DOWNLOAD JUICE WRLD COVER";
        
        player.play();

    } catch (e) {
        log.innerText = "RVC Server Timeout. The model is loading, try again in 1 minute.";
        progBar.style.backgroundColor = "red";
    }
}
